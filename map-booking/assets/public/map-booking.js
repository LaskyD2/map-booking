/*! booking-map 1.0.0 | (c)  */!function(){var e={353:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,n=36e5,o="millisecond",i="second",r="minute",s="hour",a="day",l="week",c="month",d="quarter",u="year",p="date",h="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},v=function(e,t,n){var o=String(e);return!o||o.length>=t?e:""+Array(t+1-o.length).join(n)+e},_={s:v,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),o=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+v(o,2,"0")+":"+v(i,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var o=12*(n.year()-t.year())+(n.month()-t.month()),i=t.clone().add(o,c),r=n-i<0,s=t.clone().add(o+(r?-1:1),c);return+(-(o+(n-i)/(r?i-s:s-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:c,y:u,w:l,d:a,D:p,h:s,m:r,s:i,ms:o,Q:d}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},y="en",$={};$[y]=f;var O=function(e){return e instanceof M},b=function(e,t,n){var o;if(!e)return y;if("string"==typeof e)$[e]&&(o=e),t&&($[e]=t,o=e);else{var i=e.name;$[i]=e,o=i}return!n&&o&&(y=o),o||!n&&y},w=function(e,t){if(O(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new M(n)},S=_;S.l=b,S.i=O,S.w=function(e,t){return w(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var M=function(){function f(e){this.$L=b(e.locale,null,!0),this.parse(e)}var v=f.prototype;return v.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(S.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var o=t.match(m);if(o){var i=o[2]-1||0,r=(o[7]||"0").substring(0,3);return n?new Date(Date.UTC(o[1],i,o[3]||1,o[4]||0,o[5]||0,o[6]||0,r)):new Date(o[1],i,o[3]||1,o[4]||0,o[5]||0,o[6]||0,r)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},v.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},v.$utils=function(){return S},v.isValid=function(){return!(this.$d.toString()===h)},v.isSame=function(e,t){var n=w(e);return this.startOf(t)<=n&&n<=this.endOf(t)},v.isAfter=function(e,t){return w(e)<this.startOf(t)},v.isBefore=function(e,t){return this.endOf(t)<w(e)},v.$g=function(e,t,n){return S.u(e)?this[t]:this.set(n,e)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(e,t){var n=this,o=!!S.u(t)||t,d=S.p(e),h=function(e,t){var i=S.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return o?i:i.endOf(a)},m=function(e,t){return S.w(n.toDate()[e].apply(n.toDate("s"),(o?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},g=this.$W,f=this.$M,v=this.$D,_="set"+(this.$u?"UTC":"");switch(d){case u:return o?h(1,0):h(31,11);case c:return o?h(1,f):h(0,f+1);case l:var y=this.$locale().weekStart||0,$=(g<y?g+7:g)-y;return h(o?v-$:v+(6-$),f);case a:case p:return m(_+"Hours",0);case s:return m(_+"Minutes",1);case r:return m(_+"Seconds",2);case i:return m(_+"Milliseconds",3);default:return this.clone()}},v.endOf=function(e){return this.startOf(e,!1)},v.$set=function(e,t){var n,l=S.p(e),d="set"+(this.$u?"UTC":""),h=(n={},n[a]=d+"Date",n[p]=d+"Date",n[c]=d+"Month",n[u]=d+"FullYear",n[s]=d+"Hours",n[r]=d+"Minutes",n[i]=d+"Seconds",n[o]=d+"Milliseconds",n)[l],m=l===a?this.$D+(t-this.$W):t;if(l===c||l===u){var g=this.clone().set(p,1);g.$d[h](m),g.init(),this.$d=g.set(p,Math.min(this.$D,g.daysInMonth())).$d}else h&&this.$d[h](m);return this.init(),this},v.set=function(e,t){return this.clone().$set(e,t)},v.get=function(e){return this[S.p(e)]()},v.add=function(o,d){var p,h=this;o=Number(o);var m=S.p(d),g=function(e){var t=w(h);return S.w(t.date(t.date()+Math.round(e*o)),h)};if(m===c)return this.set(c,this.$M+o);if(m===u)return this.set(u,this.$y+o);if(m===a)return g(1);if(m===l)return g(7);var f=(p={},p[r]=t,p[s]=n,p[i]=e,p)[m]||1,v=this.$d.getTime()+o*f;return S.w(v,this)},v.subtract=function(e,t){return this.add(-1*e,t)},v.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var o=e||"YYYY-MM-DDTHH:mm:ssZ",i=S.z(this),r=this.$H,s=this.$m,a=this.$M,l=n.weekdays,c=n.months,d=function(e,n,i,r){return e&&(e[n]||e(t,o))||i[n].substr(0,r)},u=function(e){return S.s(r%12||12,e,"0")},p=n.meridiem||function(e,t,n){var o=e<12?"AM":"PM";return n?o.toLowerCase():o},m={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:S.s(a+1,2,"0"),MMM:d(n.monthsShort,a,c,3),MMMM:d(c,a),D:this.$D,DD:S.s(this.$D,2,"0"),d:String(this.$W),dd:d(n.weekdaysMin,this.$W,l,2),ddd:d(n.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(r),HH:S.s(r,2,"0"),h:u(1),hh:u(2),a:p(r,s,!0),A:p(r,s,!1),m:String(s),mm:S.s(s,2,"0"),s:String(this.$s),ss:S.s(this.$s,2,"0"),SSS:S.s(this.$ms,3,"0"),Z:i};return o.replace(g,(function(e,t){return t||m[e]||i.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(o,p,h){var m,g=S.p(p),f=w(o),v=(f.utcOffset()-this.utcOffset())*t,_=this-f,y=S.m(this,f);return y=(m={},m[u]=y/12,m[c]=y,m[d]=y/3,m[l]=(_-v)/6048e5,m[a]=(_-v)/864e5,m[s]=_/n,m[r]=_/t,m[i]=_/e,m)[g]||_,h?y:S.a(y)},v.daysInMonth=function(){return this.endOf(c).$D},v.$locale=function(){return $[this.$L]},v.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),o=b(e,t,!0);return o&&(n.$L=o),n},v.clone=function(){return S.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},f}(),E=M.prototype;return w.prototype=E,[["$ms",o],["$s",i],["$m",r],["$H",s],["$W",a],["$M",c],["$y",u],["$D",p]].forEach((function(e){E[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),w.extend=function(e,t){return e.$i||(e(t,M,w),e.$i=!0),w},w.locale=b,w.isDayjs=O,w.unix=function(e){return w(1e3*e)},w.en=$[y],w.Ls=$,w.p={},w}()}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";const e=[59.931429,30.325081],t=15,o="hotels-list",i=`${o}:expire`,r=`${o}:prices`,s="price-list",a=`${s}:expire`,l=`${s}:prices`,c="minute",d={ru:{SelectDate:"Выберите дату",From:"От",NoPlaces:"Нет мест",Apartments:"квартиры",Busy:"Занято",Booking:"Забронировать",MapShow:"Посмотреть отели на карте",MapClose:"Свернуть карту"},en:{SelectDate:"Select date",From:"From",NoPlaces:"No places",Apartments:"apart.",Busy:"Busy",Booking:"Book now",MapShow:"View hotels on the map",MapClose:"Collapse map"}},u=(e,t,n,o)=>{const i=d[MAP_BOOKING_LANG];return` <div class="map__hint ${o==n?"active":""} ${t?"":"no-rooms "}" id="${n}">\n            <div class="map__hint-icon"></div>\n            <div class="map__hint-price"> ${{loader:localStorage.getItem("tl-arrivalDate")?'<div class="loader"></div>':i.SelectDate,price:t?i.From+" "+t+" ₽":i.NoPlaces}[e]}</div>\n          </div>`},p=(e,t,n,o,i)=>{const r=d[MAP_BOOKING_LANG],s=e[MAP_BOOKING_LANG],a=t[MAP_BOOKING_LANG],l=n?r.From+" "+n+" ₽":r.NoPlaces,c=`\n        <div class="balloon-button">\n                <a href="/booking/?hotel_id=${o}&date=${(new Date).toISOString().slice(0,10)}&nights=1&adults=1" class="balloon-button__link">${r.Booking}</a>\n        </div>`;return`  <div class="map__balloon">\n            <div class="balloon-hotel">${s}</div>\n             <div class="balloon-address">${a}</div>\n            <div class="balloon-price">${l}</div>\n            ${i?"":c}\n        </div`};var h=n(353),m=n.n(h);const g=async()=>{const e=await fetch("/map-booking/cache/hotel_list.json");return e.ok||console.error("null"),await e.json()},f=()=>{const e=localStorage.getItem(r);return!e||localStorage.getItem(i)<=y()?"":JSON.parse(e)},v=e=>{localStorage.setItem(r,e),localStorage.setItem(i,_().toString())},_=()=>m()().add(1440,c).unix(),y=()=>m()().unix(),$=(e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},O=()=>{let e=document.querySelector(".accordion-text");const t=document.querySelector(".accordion-map"),n=document.querySelector(".map-booking"),o=document.querySelector(".map__mobile-text");n.classList.contains("map-show")?e.innerText=d[MAP_BOOKING_LANG].MapClose:e.innerText=d[MAP_BOOKING_LANG].MapShow,t.addEventListener("click",(function(){n.classList.toggle("map-show"),n.classList.contains("map-show")?e.innerText=d[MAP_BOOKING_LANG].MapClose:e.innerText=d[MAP_BOOKING_LANG].MapShow})),o.addEventListener("click",(function(){this.style.display="none"})),document.querySelectorAll(".map__balloon-room").forEach((e=>{e.addEventListener("click",w)}))},b=(e,t)=>(e-t)/864e5,w=()=>{document.getElementById("tl-booking-form").scrollIntoView({block:"start",behavior:"smooth"})};function S(e,t,n){var o=window.location.search,i=e+"="+n,r="";r=-1!=o.indexOf(e)?o.replace(t,i):""==o?o+"?"+i:o+"&"+i,window.history.pushState(!1,!1,r)}const M=()=>{const e=f(),t=[];return Object.keys(e.hotels).forEach((n=>{let o=e.hotels[n],i={id:n,name:o.name,address:o.address,latitude:o.latitude,longitude:o.longitude,iconContent:u("loader"),width:100,roomTypes:o.rooms};t.push(i)})),t},E=()=>{let e=(()=>{let e=f(),t=[],n=[],o=[],i=[],r=$("hotel_id");e=e.apart,r&&(e.forEach((e=>{scenariosListHotel[r].toString().includes(e.id)&&t.push(e)})),e=t);for(let t=0;t<e.length;t++){if(null===e[t].longitude&&null===e[t].longitude||"0.0000"===e[t].longitude&&"0.0000"===e[t].longitude)continue;let r=!0;if(n.forEach((n=>{n.longitude===e[t].longitude&&n.latitude===e[t].latitude&&(r=!1)})),!1!==r){o.address=e[t].address[MAP_BOOKING_LANG],o.longitude=e[t].longitude,o.latitude=e[t].latitude,i.push(e[t]);for(let n=t+1;n<e.length-1;n++)e[t].longitude===e[n].longitude&&e[t].latitude===e[n].latitude&&i.push(e[n]);o.rooms=i,n.push(o),o=[],i=[]}}return n})(),t=[];return e.forEach(((e,n)=>{let o=[];e.rooms.forEach((e=>{o.push(e.id)}));let i={id:"marker-"+n,address:e.address,latitude:e.rooms[0].latitude,longitude:e.rooms[0].longitude,iconContent:u("loader"),width:90,roomTypes:o.join(",")};t.push(i)})),t},I=(e,n,o)=>{(async e=>{const t=await fetch(e);return t.ok||console.error("null"),await t.json()})(e).then((e=>{C(JSON.stringify(e));let i,r=((e,t)=>{let n=[],o=[];return Object.keys(e).map((i=>{o=[],Object.values(e[i]).map((e=>{o.push(e[t])})),n[i]=Math.min.apply(null,o)})),n})(e,o),s=M();function a(e){return!e||(Array.isArray(e)?0===e.length:"object"!=typeof e||0===Object.keys(e).length)}n&&(i=document.querySelector("#tl-hotel-select").value),async function(e,t=100){for(;a(e());)await new Promise((e=>setTimeout(e,t)));return e()}((()=>z)).then((o=>(s.forEach(((e,o)=>{let s=z[o].properties.get("name"),a=z[o].properties.get("address"),l=z[o].properties.get("id"),c=r[l];if(z[o].properties.set("iconContent",u("price",c,l,n)),z[o].properties.set("balloonContent",p(s,a,c,l,n)),z[o].properties.set("clusterCaption",p(s,a,c,l,n)),n&&l==i)try{z[o].balloon.open()}catch(e){let n=z[o].geometry.getCoordinates();q.setCenter(n,t,{duration:300}),setTimeout((()=>z[o].balloon.open()),350)}})),e)))})).catch((e=>{console.log(e),console.log("not load price")}))},A=()=>{const e=localStorage.getItem(r);return!e||localStorage.getItem(r)<=B()?"":JSON.parse(e)},C=e=>{localStorage.setItem(l,e),localStorage.setItem(a,N().toString())},N=()=>m()().add(1440,c).unix(),B=()=>m()().unix(),L=(e,t,n,o)=>` <div class="map__hint ${t?"":"no-rooms"}" id="${n}">\n            <div class="map__hint-icon"></div>\n            <div class="map__hint-price"> ${{loader:localStorage.getItem("tl-arrivalDate")?'<div class="loader"></div>':d[MAP_BOOKING_LANG].SelectDate,price:t?d[MAP_BOOKING_LANG].From+" "+t+" ₽":d[MAP_BOOKING_LANG].NoPlaces}[e]} ${o>1?" ("+o+" "+d[MAP_BOOKING_LANG].Apartments+")":""}</div>\n          </div>`,k=(e,t)=>`  <div class="map__balloon">\n            <div class="map__balloon-address">${e}</div>\n            ${function(e){return e.length?e.map((e=>` <div class="map__balloon-room">\n                     <div class="map__balloon-room-name">${e.name[MAP_BOOKING_LANG]}</div>\n                     <div class="map__balloon-room-status ${!!e.price}">${e.price?d[MAP_BOOKING_LANG].From+" "+e.price+" ₽":d[MAP_BOOKING_LANG].Busy}</div>\n                </div>`)).join(""):` <div class="map__balloon-room">\n             <div class="map__balloon-room-name">${d[MAP_BOOKING_LANG].NoPlaces}</div>\n        </div>`}(t)}\n        </div`;const D=()=>{const e=getComputedStyle(document.documentElement).getPropertyValue("--basic").trim();Z.getClusters().forEach((t=>{let n=!1;t.properties.get("geoObjects").forEach((o=>{o.properties.get("price")&&!1===n&&(n=!0,t.options.set("clusterIconColor",e))}))}))},x=e=>{let t,n=A(),o=E();n=n.apart,e?(e.forEach((e=>{z.forEach((t=>{t.properties.get("roomTypes").includes(e.id)&&(t.properties._data.price=e.price)}))})),o.forEach(((o,i)=>{let r,s=[],a=[];r=o.roomTypes,n.forEach((e=>{-1!==r.indexOf(e.id)&&a.push(e)})),e&&e.forEach((e=>{a.forEach((t=>{e.id===t.id&&(s.push(e.price),t.price=e.price)}))})),a.sort(((e,t)=>null==e.price?"1":null==t.price?"-1":e.price-t.price)),t=s.length?Math.min.apply(null,s):null;let l=z[i].properties.get("address"),c=z[i].properties.get("id");z[i].properties.set("iconContent",L("price",t,c,a.length)),z[i].properties.set("balloonContent",k(l,a))})),D(),q.events.add("boundschange",(function(e){e.get("newZoom")!==e.get("oldZoom")&&D()}))):z.forEach((e=>{e.properties.set("iconContent",L("price",void 0))}))};function T(e){let n=M();q.balloon.close(),n.forEach(((n,o)=>{if(z[o].properties.get("id")==e){let e=z[o].properties.get("iconContent").replace('class="map__hint','class="map__hint active'),n=z[o].geometry.getCoordinates();q.setCenter(n,t,{duration:300}),z[o].properties.set("iconContent",e),setTimeout((()=>{try{z[o].balloon.open()}catch(e){q.setCenter(n,t,{duration:300}),z[o].balloon.open()}}),350)}else{let e=z[o].properties.get("iconContent").replace('class="map__hint active','class="map__hint');z[o].properties.set("iconContent",e)}})),G(e)}const G=e=>{var t="hotel_id",n=new RegExp(/hotel_id=[A-Za-z0-9_-]+/g),o=window.location.search,i=t+"="+e,r="";r=-1!=o.indexOf(t)?o.replace(n,i):""==o?o+"?"+i:o+"&"+i,window.history.pushState(!1,!1,r)};function P(e,t){if(document.createEventObject){var n=document.createEventObject();return e.fireEvent("on"+t,n)}var o=document.createEvent("HTMLEvents");return o.initEvent(t,!0,!0),!e.dispatchEvent(o)}function j(e){let t,n=null;if("search-rooms"===e.action){if(t=e.rooms,n=A(),$("date")){let t=e.arrival,n=e.departure,o=b(new Date(n),new Date(t));S("date",new RegExp(/date=[A-Za-z0-9_-]+/g),t),S("nights",new RegExp(/nights=\d+/g),o)}x(t)}}function H(e){let t=e.rooms;A();x(t)}function K(e){let t=Object.keys(JSON.parse(localStorage.getItem("tl:storage:puid")))[0];!function(n){var o;o=[["setContext",t,`${MAP_BOOKING_LANG}`],["embed","booking-form",{container:"tl-booking-form",roomType:e,autoScroll:"none",onTrackUserAction:j,onNoAvailableRooms:H}]];var i=n.travelline=n.travelline||{},r=i.integration=i.integration||{};if(r.__cq=r.__cq?r.__cq.concat(o):o,!r.__loader){r.__loader=!0;var s=n.document,a=s.getElementsByTagName("head")[0]||s.getElementsByTagName("body")[0];function l(e,t){return function(){n.TL||(a.removeChild(e),t())}}!function e(t){if(0!==t.length){var n=s.createElement("script");n.type="text/javascript",n.async=!0,n.src="https://"+t[0]+"/integration/loader.js",n.onerror=n.onload=l(n,(function(){e(t.slice(1,t.length))})),a.appendChild(n)}}(["ru-ibe.tlintegration.ru","ibe.tlintegration.ru","ibe.tlintegration.com"])}}(window)}let Z,q,z=[],F=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function Y(){q=new ymaps.Map("map-be",{center:e,zoom:t,controls:["zoomControl"],behaviors:F?["dblClickZoom","multiTouch"]:["drag","scrollZoom"]}),"hotels".includes(Object.keys(f()))&&R(M()),"apart".includes(Object.keys(f()))&&J(E())}let R=e=>{q.geoObjects.removeAll(),z.length=0,q.setZoom(t),e.forEach(((t,n)=>{z[n]=new ymaps.Placemark([e[n].latitude,e[n].longitude],{iconContent:e[n].iconContent,id:e[n].id,name:e[n].name,address:e[n].address,roomTypes:e[n].roomTypes,price:null},{iconLayout:"default#imageWithContent",iconImageSize:[e[n].width,30],iconImageOffset:[0,-15],iconImageClipRect:[[415,0],[461,57]],hideIconOnBalloonOpen:!1,balloonOffset:[20,-15]}),z[n].events.add("click",(function(e){let t=e.get("target").properties.get("id");null==document.getElementById(t)?w():document.getElementById(t).classList.contains("active")||(G(t),function(){let e=$("hotel_id"),t=document.querySelector("#tl-hotel-select");t&&(t.value=e,P(t[0],"change"))}()),M().forEach(((e,n)=>{if(z[n].properties.get("id")===t){let e=z[n].properties.get("iconContent").replace('class="map__hint','class="map__hint active');z[n].properties.set("iconContent",e)}else{let e=z[n].properties.get("iconContent").replace('class="map__hint active','class="map__hint');z[n].properties.set("iconContent",e)}})),e.stopPropagation()})),z[n].events.add("balloonopen",(function(){let e=document.querySelectorAll(".balloon-hotel"),t=document.getElementById("tl-booking-form"),n=()=>{t.scrollIntoView({block:"start",behavior:"smooth"})};e.forEach((e=>{e.addEventListener("click",n)}))}))})),Z=new ymaps.Clusterer({gridSize:12,clusterIconColor:"#76689A"}),q.geoObjects.add(Z),Z.add(z),q.setBounds(q.geoObjects.getBounds()),(()=>{let e;M().forEach(((t,n)=>{let o=[];e=o.length?Math.min.apply(null,o):null,z[n].properties.set("iconContent",u("loader",e))})),D(),q.events.add("boundschange",(function(e){e.get("newZoom")!==e.get("oldZoom")&&D()}))})(f())},J=e=>{q.geoObjects.removeAll(),z.length=0,q.setZoom(t),e.forEach(((t,n)=>{z[n]=new ymaps.Placemark([e[n].latitude,e[n].longitude],{iconContent:e[n].iconContent,roomTypes:e[n].roomTypes,address:e[n].address,id:e[n].id,price:null},{iconLayout:"default#imageWithContent",iconImageSize:[e[n].width,30],iconImageOffset:[0,-15],iconImageClipRect:[[415,0],[461,57]],hideIconOnBalloonOpen:!1,balloonOffset:[20,-15]}),z[n].events.add("click",(function(e){let t=e.get("target"),n=t.properties.get("roomTypes"),o=t.properties.get("id");null==document.getElementById(o)?w():document.getElementById(o).classList.contains("active")||K(n),document.querySelectorAll(".map__hint").forEach((e=>{e.classList.remove("active")})),document.getElementById(o)&&(document.getElementById(o).classList.add("active-check"),document.getElementById(o).classList.add("active")),e.stopPropagation()})),z[n].events.add("balloonopen",(function(){let e=document.getElementById("tl-booking-form"),t=document.querySelectorAll(".map__balloon-room"),n=()=>{e.scrollIntoView({block:"start",behavior:"smooth"})};t.forEach((e=>{e.addEventListener("click",n)}))})),z[n].events.add("balloonclose",(function(e){let t=e.get("target").properties.get("id");document.getElementById(t)&&(document.getElementById(t).classList.add("active-check"),document.getElementById(t).classList.remove("active"))}))})),Z=new ymaps.Clusterer({gridSize:115,clusterIconColor:"#7F7165"}),Z.events.add("click",(e=>{if(ymaps.util.bounds.containsBounds(q.getBounds(),Z.getBounds())){Z.options.set("clusterDisableClickZoom",!0),e.stopPropagation();const t=ymaps.util.bounds.getCenter(Z.getBounds());q.setCenter(t,q.getZoom())}Z.options.set("clusterDisableClickZoom",!1)})),q.geoObjects.add(Z),Z.add(z),q.setBounds(q.geoObjects.getBounds())};const W=()=>{window.MAP_BOOKING_LANG=(()=>{const e=document.documentElement.lang,t=Object.keys(d),n=2===e.length?e.toLowerCase():e.substring(0,2);return t.includes(n)?n:"not-supported"})()};class V{constructor(){this._cacheHotels=f()}isLoadNeeded(){return!this._cacheHotels}load(){return g().then((e=>(v(JSON.stringify(e)),e))).catch((e=>{console.log("HotelLoad load error:"),console.log(e)}))}getFromCache(){return console.log(this._cacheHotels),JSON.parse(this._cacheHotels)}}let U=!1;window.setTlHotel=()=>{(new V).load().then((()=>{W(),O(),localStorage.getItem(r)||g().then((e=>(v(JSON.stringify(e)),e))).catch((()=>{console.log("not load")})),ymaps.ready(Y),U=!0}))},document.addEventListener("DOMContentLoaded",(()=>{window.setTlHotel()})),window.mapBookingHotel=(e,t,n,o,i)=>{function r(){if(U){if(((e,t,n,o)=>{const i=`/map-booking/core/price-api.php?date=${e}&nights=${t}&adults=${n}`;let r=M();0!==z.length&&r.forEach(((e,t)=>{z[t].properties.set("iconContent",u("loader"))})),I(i,o,n)})(e,t,n,o),q.balloon.close(),$("date")){S("date",new RegExp(/date=[A-Za-z0-9_-]+/g),e),S("nights",new RegExp(/nights=\d+/g),t)}}else setTimeout(r,300)}r(),document.querySelector("#tl-hotel-select").addEventListener("change",(function(){T(this.value)}))},window.mapBookingApart=(e,t,n)=>{!function o(){if(U){if(q.balloon.close(),x(e),$("date")){S("date",new RegExp(/date=[A-Za-z0-9_-]+/g),t);let e=b(new Date(n),new Date(t));S("nights",new RegExp(/nights=\d+/g),e)}}else setTimeout(o,300)}()}}()}();
//# sourceMappingURL=map-booking.js.map