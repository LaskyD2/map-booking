/*! booking-map 1.0.0 | (c)  */!function(){var e={353:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,n=36e5,o="millisecond",r="second",i="minute",s="hour",a="day",l="week",c="month",u="quarter",d="year",h="date",p="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,f=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},v=function(e,t,n){var o=String(e);return!o||o.length>=t?e:""+Array(t+1-o.length).join(n)+e},_={s:v,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),o=Math.floor(n/60),r=n%60;return(t<=0?"+":"-")+v(o,2,"0")+":"+v(r,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var o=12*(n.year()-t.year())+(n.month()-t.month()),r=t.clone().add(o,c),i=n-r<0,s=t.clone().add(o+(i?-1:1),c);return+(-(o+(n-r)/(i?r-s:s-r))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:c,y:d,w:l,d:a,D:h,h:s,m:i,s:r,ms:o,Q:u}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},y="en",$={};$[y]=g;var O=function(e){return e instanceof M},b=function(e,t,n){var o;if(!e)return y;if("string"==typeof e)$[e]&&(o=e),t&&($[e]=t,o=e);else{var r=e.name;$[r]=e,o=r}return!n&&o&&(y=o),o||!n&&y},w=function(e,t){if(O(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new M(n)},S=_;S.l=b,S.i=O,S.w=function(e,t){return w(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var M=function(){function g(e){this.$L=b(e.locale,null,!0),this.parse(e)}var v=g.prototype;return v.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(S.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var o=t.match(m);if(o){var r=o[2]-1||0,i=(o[7]||"0").substring(0,3);return n?new Date(Date.UTC(o[1],r,o[3]||1,o[4]||0,o[5]||0,o[6]||0,i)):new Date(o[1],r,o[3]||1,o[4]||0,o[5]||0,o[6]||0,i)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},v.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},v.$utils=function(){return S},v.isValid=function(){return!(this.$d.toString()===p)},v.isSame=function(e,t){var n=w(e);return this.startOf(t)<=n&&n<=this.endOf(t)},v.isAfter=function(e,t){return w(e)<this.startOf(t)},v.isBefore=function(e,t){return this.endOf(t)<w(e)},v.$g=function(e,t,n){return S.u(e)?this[t]:this.set(n,e)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(e,t){var n=this,o=!!S.u(t)||t,u=S.p(e),p=function(e,t){var r=S.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return o?r:r.endOf(a)},m=function(e,t){return S.w(n.toDate()[e].apply(n.toDate("s"),(o?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},f=this.$W,g=this.$M,v=this.$D,_="set"+(this.$u?"UTC":"");switch(u){case d:return o?p(1,0):p(31,11);case c:return o?p(1,g):p(0,g+1);case l:var y=this.$locale().weekStart||0,$=(f<y?f+7:f)-y;return p(o?v-$:v+(6-$),g);case a:case h:return m(_+"Hours",0);case s:return m(_+"Minutes",1);case i:return m(_+"Seconds",2);case r:return m(_+"Milliseconds",3);default:return this.clone()}},v.endOf=function(e){return this.startOf(e,!1)},v.$set=function(e,t){var n,l=S.p(e),u="set"+(this.$u?"UTC":""),p=(n={},n[a]=u+"Date",n[h]=u+"Date",n[c]=u+"Month",n[d]=u+"FullYear",n[s]=u+"Hours",n[i]=u+"Minutes",n[r]=u+"Seconds",n[o]=u+"Milliseconds",n)[l],m=l===a?this.$D+(t-this.$W):t;if(l===c||l===d){var f=this.clone().set(h,1);f.$d[p](m),f.init(),this.$d=f.set(h,Math.min(this.$D,f.daysInMonth())).$d}else p&&this.$d[p](m);return this.init(),this},v.set=function(e,t){return this.clone().$set(e,t)},v.get=function(e){return this[S.p(e)]()},v.add=function(o,u){var h,p=this;o=Number(o);var m=S.p(u),f=function(e){var t=w(p);return S.w(t.date(t.date()+Math.round(e*o)),p)};if(m===c)return this.set(c,this.$M+o);if(m===d)return this.set(d,this.$y+o);if(m===a)return f(1);if(m===l)return f(7);var g=(h={},h[i]=t,h[s]=n,h[r]=e,h)[m]||1,v=this.$d.getTime()+o*g;return S.w(v,this)},v.subtract=function(e,t){return this.add(-1*e,t)},v.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||p;var o=e||"YYYY-MM-DDTHH:mm:ssZ",r=S.z(this),i=this.$H,s=this.$m,a=this.$M,l=n.weekdays,c=n.months,u=function(e,n,r,i){return e&&(e[n]||e(t,o))||r[n].substr(0,i)},d=function(e){return S.s(i%12||12,e,"0")},h=n.meridiem||function(e,t,n){var o=e<12?"AM":"PM";return n?o.toLowerCase():o},m={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:S.s(a+1,2,"0"),MMM:u(n.monthsShort,a,c,3),MMMM:u(c,a),D:this.$D,DD:S.s(this.$D,2,"0"),d:String(this.$W),dd:u(n.weekdaysMin,this.$W,l,2),ddd:u(n.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(i),HH:S.s(i,2,"0"),h:d(1),hh:d(2),a:h(i,s,!0),A:h(i,s,!1),m:String(s),mm:S.s(s,2,"0"),s:String(this.$s),ss:S.s(this.$s,2,"0"),SSS:S.s(this.$ms,3,"0"),Z:r};return o.replace(f,(function(e,t){return t||m[e]||r.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(o,h,p){var m,f=S.p(h),g=w(o),v=(g.utcOffset()-this.utcOffset())*t,_=this-g,y=S.m(this,g);return y=(m={},m[d]=y/12,m[c]=y,m[u]=y/3,m[l]=(_-v)/6048e5,m[a]=(_-v)/864e5,m[s]=_/n,m[i]=_/t,m[r]=_/e,m)[f]||_,p?y:S.a(y)},v.daysInMonth=function(){return this.endOf(c).$D},v.$locale=function(){return $[this.$L]},v.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),o=b(e,t,!0);return o&&(n.$L=o),n},v.clone=function(){return S.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},g}(),A=M.prototype;return w.prototype=A,[["$ms",o],["$s",r],["$m",i],["$H",s],["$W",a],["$M",c],["$y",d],["$D",h]].forEach((function(e){A[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),w.extend=function(e,t){return e.$i||(e(t,M,w),e.$i=!0),w},w.locale=b,w.isDayjs=O,w.unix=function(e){return w(1e3*e)},w.en=$[y],w.Ls=$,w.p={},w}()}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";const e=[59.931429,30.325081],t=15,o="hotels-list",r=`${o}:expire`,i=`${o}:prices`,s="price-list",a=`${s}:expire`,l=`${s}:prices`,c="minute",u={ru:{SelectDate:"Выберите дату",From:"От",NoPlaces:"Нет мест",Apartments:"квартиры",Busy:"Занято",Booking:"Забронировать",MapShow:"Посмотреть отели на карте",MapClose:"Свернуть карту"},en:{SelectDate:"Select date",From:"From",NoPlaces:"No places",Apartments:"apart.",Busy:"Busy",Booking:"Book now",MapShow:"View hotels on the map",MapClose:"Collapse map"}},d=(e,t,n,o)=>{const r=u[MAP_BOOKING_LANG];return` <div class="map__hint ${o==n?"active":""} ${t?"":"no-rooms "}" id="${n}">\n            <div class="map__hint-icon"></div>\n            <div class="map__hint-price"> ${{loader:localStorage.getItem("tl-arrivalDate")?'<div class="loader"></div>':r.SelectDate,price:t?r.From+" "+t+" ₽":r.NoPlaces}[e]}</div>\n          </div>`},h=(e,t,n,o,r)=>{const i=u[MAP_BOOKING_LANG],s=e[MAP_BOOKING_LANG],a=t[MAP_BOOKING_LANG],l=n?i.From+" "+n+" ₽":i.NoPlaces,c=`\n        <div class="balloon-button">\n                <a href="/booking/?hotel_id=${o}&date=${(new Date).toISOString().slice(0,10)}&nights=1&adults=1" class="balloon-button__link">${i.Booking}</a>\n        </div>`;return`  <div class="map__balloon">\n            <div class="balloon-hotel">${s}</div>\n             <div class="balloon-address">${a}</div>\n            <div class="balloon-price">${l}</div>\n            ${r?"":c}\n        </div`};var p=n(353),m=n.n(p);const f=async()=>{const e=await fetch("/map-booking/cache/hotel_list.json");return e.ok||console.error("null"),await e.json()},g=()=>{const e=localStorage.getItem(i);return!e||localStorage.getItem(r)<=y()?"":JSON.parse(e)},v=e=>{localStorage.setItem(i,e),localStorage.setItem(r,_().toString())},_=()=>m()().add(1440,c).unix(),y=()=>m()().unix(),$=(e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},O=()=>{let e=document.querySelector(".accordion-text");const t=document.querySelector(".accordion-map"),n=document.querySelector(".map-booking"),o=document.querySelector(".map__mobile-text");n.classList.contains("map-show")?e.innerText=u[MAP_BOOKING_LANG].MapClose:e.innerText=u[MAP_BOOKING_LANG].MapShow,t.addEventListener("click",(function(){n.classList.toggle("map-show"),n.classList.contains("map-show")?e.innerText=u[MAP_BOOKING_LANG].MapClose:e.innerText=u[MAP_BOOKING_LANG].MapShow})),o.addEventListener("click",(function(){this.style.display="none"})),document.querySelectorAll(".map__balloon-room").forEach((e=>{e.addEventListener("click",w)}))},b=(e,t)=>(e-t)/864e5,w=()=>{document.getElementById("tl-booking-form").scrollIntoView({block:"start",behavior:"smooth"})};function S(e,t,n){var o=window.location.search,r=e+"="+n,i="";i=-1!=o.indexOf(e)?o.replace(t,r):""==o?o+"?"+r:o+"&"+r,window.history.pushState(!1,!1,i)}const M=()=>{const e=g(),t=[];return Object.keys(e.hotels).forEach((n=>{let o=e.hotels[n],r={id:n,name:o.name,address:o.address,latitude:o.latitude,longitude:o.longitude,iconContent:d("loader"),width:100,roomTypes:o.rooms};t.push(r)})),t},A=e=>{let t=(()=>{let e=g(),t=[],n=[],o=[];if($("hotel_id"))e=e.apart[$("hotel_id")];else{const t=Object.keys(e.apart);e=e.apart[t]}for(let r=0;r<e.length;r++){if(null===e[r].longitude&&null===e[r].longitude||"0.0000"===e[r].longitude&&"0.0000"===e[r].longitude)continue;let i=!0;if(t.forEach((t=>{t.longitude===e[r].longitude&&t.latitude===e[r].latitude&&(i=!1)})),!1!==i){n.address=e[r].address[MAP_BOOKING_LANG],n.longitude=e[r].longitude,n.latitude=e[r].latitude,o.push(e[r]);for(let t=r+1;t<e.length-1;t++)e[r].longitude===e[t].longitude&&e[r].latitude===e[t].latitude&&o.push(e[t]);n.rooms=o,t.push(n),n=[],o=[]}}return t})(),n=[];return t.forEach(((e,t)=>{let o=[];e.rooms.forEach((e=>{o.push(e.id)}));let r={id:"marker-"+t,address:e.address,latitude:e.rooms[0].latitude,longitude:e.rooms[0].longitude,iconContent:d("loader"),width:90,roomTypes:o.join(",")};n.push(r)})),n},E=(e,n,o)=>{(async e=>{const t=await fetch(e);return t.ok||console.error("null"),await t.json()})(e).then((e=>{N(JSON.stringify(e));let r,i=((e,t)=>{const n={},o=String(t);return Object.keys(e).forEach((t=>{const r=[];Object.values(e[t]).forEach((e=>{const t=e[o];"number"==typeof t&&Number.isFinite(t)&&r.push(t)})),r.length>0&&(n[t]=Math.min(...r))})),n})(e,o),s=M();function a(e){return!e||(Array.isArray(e)?0===e.length:"object"!=typeof e||0===Object.keys(e).length)}n&&(r=document.querySelector("#tl-hotel-select").value),async function(e,t=100){for(;a(e());)await new Promise((e=>setTimeout(e,t)));return e()}((()=>F)).then((o=>(s.forEach(((e,o)=>{let s=F[o].properties.get("name"),a=F[o].properties.get("address"),l=F[o].properties.get("id"),c=i[l];if(F[o].properties.set("iconContent",d("price",c,l,n)),F[o].properties.set("balloonContent",h(s,a,c,l,n)),F[o].properties.set("clusterCaption",h(s,a,c,l,n)),n&&l==r)try{F[o].balloon.open()}catch(e){let n=F[o].geometry.getCoordinates();q.setCenter(n,t,{duration:300}),setTimeout((()=>F[o].balloon.open()),350)}})),e)))})).catch((e=>{console.log(e),console.log("not load price")}))},I=()=>{const e=localStorage.getItem(i);return!e||localStorage.getItem(i)<=B()?"":JSON.parse(e)},N=e=>{localStorage.setItem(l,e),localStorage.setItem(a,C().toString())},C=()=>m()().add(1440,c).unix(),B=()=>m()().unix(),k=(e,t,n,o)=>{let r={loader:localStorage.getItem("tl-arrivalDate")?'<div class="loader"></div>':u[MAP_BOOKING_LANG].SelectDate,price:t?u[MAP_BOOKING_LANG].From+" "+t+" ₽":u[MAP_BOOKING_LANG].NoPlaces},i=u[MAP_BOOKING_LANG].Apartments;return"ru"===MAP_BOOKING_LANG&&(i=function(e){const t=(e=Math.abs(Math.floor(e)))%10,n=e%100;return 1===t&&11!==n?`${e} квартира`:t>=2&&t<=4&&!(n>=12&&n<=14)?`${e} квартиры`:`${e} квартир`}(o)),` <div class="map__hint ${t?"":"no-rooms"}" id="${n}">\n            <div class="map__hint-icon"></div>\n            <div class="map__hint-price"> ${r[e]} ${o>1?" ("+i+")":""}</div>\n          </div>`},L=(e,t)=>`  <div class="map__balloon">\n            <div class="map__balloon-address">${e}</div>\n            ${function(e){return e.length?e.map((e=>` <div class="map__balloon-room">\n                     <div class="map__balloon-room-name">${e.name[MAP_BOOKING_LANG]}</div>\n                     <div class="map__balloon-room-status ${!!e.price}">${e.price?u[MAP_BOOKING_LANG].From+" "+e.price+" ₽":u[MAP_BOOKING_LANG].Busy}</div>\n                </div>`)).join(""):` <div class="map__balloon-room">\n             <div class="map__balloon-room-name">${u[MAP_BOOKING_LANG].NoPlaces}</div>\n        </div>`}(t)}\n        </div`;const D=()=>{const e=getComputedStyle(document.documentElement).getPropertyValue("--basic").trim();Z.getClusters().forEach((t=>{let n=!1;t.properties.get("geoObjects").forEach((o=>{o.properties.get("price")&&!1===n&&(n=!0,t.options.set("clusterIconColor",e))}))}))},T=(e,t)=>{let n,o=I(),r=A();o=o.apart[t],e?(e.forEach((e=>{F.forEach((t=>{t.properties.get("roomTypes").includes(e.id)&&(t.properties._data.price=e.price)}))})),r.forEach(((t,r)=>{let i,s=[],a=[];i=t.roomTypes,o.forEach((e=>{-1!==i.indexOf(e.id)&&a.push(e)})),e&&e.forEach((e=>{a.forEach((t=>{e.id===t.id&&(s.push(e.price),t.price=e.price)}))})),a.sort(((e,t)=>null==e.price?"1":null==t.price?"-1":e.price-t.price)),n=s.length?Math.min.apply(null,s):null;let l=F[r].properties.get("address"),c=F[r].properties.get("id");F[r].properties.set("iconContent",k("price",n,c,a.length)),F[r].properties.set("balloonContent",L(l,a))})),D(),q.events.add("boundschange",(function(e){e.get("newZoom")!==e.get("oldZoom")&&D()}))):F.forEach((e=>{e.properties.set("iconContent",k("price",void 0))}))};function G(e){let n=M();q.balloon.close(),n.forEach(((n,o)=>{if(F[o].properties.get("id")==e){let e=F[o].properties.get("iconContent").replace('class="map__hint','class="map__hint active'),n=F[o].geometry.getCoordinates();q.setCenter(n,t,{duration:300}),F[o].properties.set("iconContent",e),setTimeout((()=>{try{F[o].balloon.open()}catch(e){q.setCenter(n,t,{duration:300}),F[o].balloon.open()}}),350)}else{let e=F[o].properties.get("iconContent").replace('class="map__hint active','class="map__hint');F[o].properties.set("iconContent",e)}})),x(e)}const x=e=>{var t="hotel_id",n=new RegExp(/hotel_id=[A-Za-z0-9_-]+/g),o=window.location.search,r=t+"="+e,i="";i=-1!=o.indexOf(t)?o.replace(n,r):""==o?o+"?"+r:o+"&"+r,window.history.pushState(!1,!1,i)};function P(e,t){if(document.createEventObject){var n=document.createEventObject();return e.fireEvent("on"+t,n)}var o=document.createEvent("HTMLEvents");return o.initEvent(t,!0,!0),!e.dispatchEvent(o)}function j(e){let t;if("search-rooms"===e.action){t=e.rooms;let n=e.providerId;if($("date")){let t=e.arrival,n=e.departure,o=b(new Date(n),new Date(t));S("date",new RegExp(/date=[A-Za-z0-9_-]+/g),t),S("nights",new RegExp(/nights=\d+/g),o)}T(t,n)}}function H(e){let t=e.rooms,n=I();T(t,n)}function K(e){const t=function(e="TL;profile;"){for(let t=0;t<sessionStorage.length;t++){const n=sessionStorage.key(t);if(n.includes(e)){const e=n.split(";");if(e.length>2)try{return JSON.parse(e[2]).key||null}catch{return null}}}return null}().split(".")[0];!function(n){var o;o=[["setContext",t+"."+$("hotel_id"),`${MAP_BOOKING_LANG}`],["embed","booking-form",{container:"tl-booking-form",roomType:e,autoScroll:"none",onTrackUserAction:j,onNoAvailableRooms:H}]];var r=n.travelline=n.travelline||{},i=r.integration=r.integration||{};if(i.__cq=i.__cq?i.__cq.concat(o):o,!i.__loader){i.__loader=!0;var s=n.document,a=s.getElementsByTagName("head")[0]||s.getElementsByTagName("body")[0];function l(e,t){return function(){n.TL||(a.removeChild(e),t())}}!function e(t){if(0!==t.length){var n=s.createElement("script");n.type="text/javascript",n.async=!0,n.src="https://"+t[0]+"/integration/loader.js",n.onerror=n.onload=l(n,(function(){e(t.slice(1,t.length))})),a.appendChild(n)}}(["ru-ibe.tlintegration.ru","ibe.tlintegration.ru","ibe.tlintegration.com"])}}(window)}let Z,q,F=[],z=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function J(){if(q=new ymaps.Map("map-be",{center:e,zoom:t,controls:["zoomControl"],behaviors:z?["dblClickZoom","multiTouch"]:["drag","scrollZoom"]}),"hotels".includes(Object.keys(g()))&&Y(M()),"apart".includes(Object.keys(g()))){function n(){const e=function(){const e=Object.keys(sessionStorage);for(const t of e)if(t.startsWith("TL;host;"))try{const e=t.slice(8);if(JSON.parse(e).hotel_code)return t}catch(e){}return null}();if(e){const t=e.slice(8);JSON.parse(t).hotel_code;R(A())}else setTimeout(n,1e3)}n()}}let Y=e=>{q.geoObjects.removeAll(),F.length=0,q.setZoom(t),e.forEach(((t,n)=>{F[n]=new ymaps.Placemark([e[n].latitude,e[n].longitude],{iconContent:e[n].iconContent,id:e[n].id,name:e[n].name,address:e[n].address,roomTypes:e[n].roomTypes,price:null},{iconLayout:"default#imageWithContent",iconImageSize:[e[n].width,30],iconImageOffset:[0,-15],iconImageClipRect:[[415,0],[461,57]],hideIconOnBalloonOpen:!1,balloonOffset:[20,-15]}),F[n].events.add("click",(function(e){let t=e.get("target").properties.get("id");null==document.getElementById(t)?w():document.getElementById(t).classList.contains("active")||(x(t),function(){let e=$("hotel_id"),t=document.querySelector("#tl-hotel-select");t&&(t.value=e,P(t[0],"change"))}()),M().forEach(((e,n)=>{if(F[n].properties.get("id")===t){let e=F[n].properties.get("iconContent").replace('class="map__hint','class="map__hint active');F[n].properties.set("iconContent",e)}else{let e=F[n].properties.get("iconContent").replace('class="map__hint active','class="map__hint');F[n].properties.set("iconContent",e)}})),e.stopPropagation()})),F[n].events.add("balloonopen",(function(){let e=document.querySelectorAll(".balloon-hotel"),t=document.getElementById("tl-booking-form"),n=()=>{t.scrollIntoView({block:"start",behavior:"smooth"})};e.forEach((e=>{e.addEventListener("click",n)}))}))})),Z=new ymaps.Clusterer({gridSize:12,clusterIconColor:"#76689A"}),q.geoObjects.add(Z),Z.add(F),q.setBounds(q.geoObjects.getBounds()),(()=>{let e;M().forEach(((t,n)=>{let o=[];e=o.length?Math.min.apply(null,o):null,F[n].properties.set("iconContent",d("loader",e))})),D(),q.events.add("boundschange",(function(e){e.get("newZoom")!==e.get("oldZoom")&&D()}))})(g())},R=e=>{q.geoObjects.removeAll(),F.length=0,q.setZoom(t),e.forEach(((t,n)=>{F[n]=new ymaps.Placemark([e[n].latitude,e[n].longitude],{iconContent:e[n].iconContent,roomTypes:e[n].roomTypes,address:e[n].address,id:e[n].id,price:null},{iconLayout:"default#imageWithContent",iconImageSize:[e[n].width,30],iconImageOffset:[0,-15],iconImageClipRect:[[415,0],[461,57]],hideIconOnBalloonOpen:!1,balloonOffset:[20,-15]}),F[n].events.add("click",(function(e){let t=e.get("target"),n=t.properties.get("roomTypes"),o=t.properties.get("id");null==document.getElementById(o)?w():document.getElementById(o).classList.contains("active")||K(n),document.querySelectorAll(".map__hint").forEach((e=>{e.classList.remove("active")})),document.getElementById(o)&&(document.getElementById(o).classList.add("active-check"),document.getElementById(o).classList.add("active")),e.stopPropagation()})),F[n].events.add("balloonopen",(function(){let e=document.getElementById("tl-booking-form"),t=document.querySelectorAll(".map__balloon-room"),n=()=>{e.scrollIntoView({block:"start",behavior:"smooth"})};t.forEach((e=>{e.addEventListener("click",n)}))})),F[n].events.add("balloonclose",(function(e){let t=e.get("target").properties.get("id");document.getElementById(t)&&(document.getElementById(t).classList.add("active-check"),document.getElementById(t).classList.remove("active"))}))})),Z=new ymaps.Clusterer({gridSize:115,clusterIconColor:"#7F7165"}),Z.events.add("click",(e=>{if(ymaps.util.bounds.containsBounds(q.getBounds(),Z.getBounds())){Z.options.set("clusterDisableClickZoom",!0),e.stopPropagation();const t=ymaps.util.bounds.getCenter(Z.getBounds());q.setCenter(t,q.getZoom())}Z.options.set("clusterDisableClickZoom",!1)})),q.geoObjects.add(Z),Z.add(F),q.setBounds(q.geoObjects.getBounds())};const W=()=>{window.MAP_BOOKING_LANG=(()=>{const e=document.documentElement.lang,t=Object.keys(u),n=2===e.length?e.toLowerCase():e.substring(0,2);return t.includes(n)?n:"ru"})()};class V{constructor(){this._cacheHotels=g()}isLoadNeeded(){return!this._cacheHotels}load(){return f().then((e=>(v(JSON.stringify(e)),e))).catch((e=>{console.log("HotelLoad load error:"),console.log(e)}))}getFromCache(){return console.log(this._cacheHotels),JSON.parse(this._cacheHotels)}}let U=!1;window.setTlHotel=()=>{(new V).load().then((()=>{W(),O(),localStorage.getItem(i)||f().then((e=>(v(JSON.stringify(e)),e))).catch((()=>{console.log("not load")})),ymaps.ready(J),U=!0}))},document.addEventListener("DOMContentLoaded",(()=>{window.setTlHotel()})),window.mapBookingHotel=(e,t,n,o,r)=>{function i(){if(U){if(((e,t,n,o)=>{const r=`/map-booking/core/price-api.php?date=${e}&nights=${t}&adults=${n}`;let i=M();0!==F.length&&i.forEach(((e,t)=>{F[t].properties.set("iconContent",d("loader"))})),E(r,o,n)})(e,t,n,o),q.balloon.close(),$("date")){S("date",new RegExp(/date=[A-Za-z0-9_-]+/g),e),S("nights",new RegExp(/nights=\d+/g),t)}}else setTimeout(i,300)}i(),document.querySelector("#tl-hotel-select").addEventListener("change",(function(){G(this.value)}))},window.mapBookingApart=(e,t,n,o)=>{!function r(){if(U){if(q.balloon.close(),T(e,o),$("date")){S("date",new RegExp(/date=[A-Za-z0-9_-]+/g),t);let e=b(new Date(n),new Date(t));S("nights",new RegExp(/nights=\d+/g),e)}}else setTimeout(r,300)}()}}()}();
//# sourceMappingURL=map-booking.js.map