/*! booking-map 1.0.0 | (c)  */!function(){var e={353:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,n=36e5,o="millisecond",r="second",i="minute",s="hour",a="day",l="week",c="month",d="quarter",u="year",p="date",h="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},v=function(e,t,n){var o=String(e);return!o||o.length>=t?e:""+Array(t+1-o.length).join(n)+e},_={s:v,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),o=Math.floor(n/60),r=n%60;return(t<=0?"+":"-")+v(o,2,"0")+":"+v(r,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var o=12*(n.year()-t.year())+(n.month()-t.month()),r=t.clone().add(o,c),i=n-r<0,s=t.clone().add(o+(i?-1:1),c);return+(-(o+(n-r)/(i?r-s:s-r))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:c,y:u,w:l,d:a,D:p,h:s,m:i,s:r,ms:o,Q:d}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},y="en",$={};$[y]=f;var O=function(e){return e instanceof M},b=function(e,t,n){var o;if(!e)return y;if("string"==typeof e)$[e]&&(o=e),t&&($[e]=t,o=e);else{var r=e.name;$[r]=e,o=r}return!n&&o&&(y=o),o||!n&&y},w=function(e,t){if(O(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new M(n)},S=_;S.l=b,S.i=O,S.w=function(e,t){return w(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var M=function(){function f(e){this.$L=b(e.locale,null,!0),this.parse(e)}var v=f.prototype;return v.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(S.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var o=t.match(m);if(o){var r=o[2]-1||0,i=(o[7]||"0").substring(0,3);return n?new Date(Date.UTC(o[1],r,o[3]||1,o[4]||0,o[5]||0,o[6]||0,i)):new Date(o[1],r,o[3]||1,o[4]||0,o[5]||0,o[6]||0,i)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},v.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},v.$utils=function(){return S},v.isValid=function(){return!(this.$d.toString()===h)},v.isSame=function(e,t){var n=w(e);return this.startOf(t)<=n&&n<=this.endOf(t)},v.isAfter=function(e,t){return w(e)<this.startOf(t)},v.isBefore=function(e,t){return this.endOf(t)<w(e)},v.$g=function(e,t,n){return S.u(e)?this[t]:this.set(n,e)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(e,t){var n=this,o=!!S.u(t)||t,d=S.p(e),h=function(e,t){var r=S.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return o?r:r.endOf(a)},m=function(e,t){return S.w(n.toDate()[e].apply(n.toDate("s"),(o?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},g=this.$W,f=this.$M,v=this.$D,_="set"+(this.$u?"UTC":"");switch(d){case u:return o?h(1,0):h(31,11);case c:return o?h(1,f):h(0,f+1);case l:var y=this.$locale().weekStart||0,$=(g<y?g+7:g)-y;return h(o?v-$:v+(6-$),f);case a:case p:return m(_+"Hours",0);case s:return m(_+"Minutes",1);case i:return m(_+"Seconds",2);case r:return m(_+"Milliseconds",3);default:return this.clone()}},v.endOf=function(e){return this.startOf(e,!1)},v.$set=function(e,t){var n,l=S.p(e),d="set"+(this.$u?"UTC":""),h=(n={},n[a]=d+"Date",n[p]=d+"Date",n[c]=d+"Month",n[u]=d+"FullYear",n[s]=d+"Hours",n[i]=d+"Minutes",n[r]=d+"Seconds",n[o]=d+"Milliseconds",n)[l],m=l===a?this.$D+(t-this.$W):t;if(l===c||l===u){var g=this.clone().set(p,1);g.$d[h](m),g.init(),this.$d=g.set(p,Math.min(this.$D,g.daysInMonth())).$d}else h&&this.$d[h](m);return this.init(),this},v.set=function(e,t){return this.clone().$set(e,t)},v.get=function(e){return this[S.p(e)]()},v.add=function(o,d){var p,h=this;o=Number(o);var m=S.p(d),g=function(e){var t=w(h);return S.w(t.date(t.date()+Math.round(e*o)),h)};if(m===c)return this.set(c,this.$M+o);if(m===u)return this.set(u,this.$y+o);if(m===a)return g(1);if(m===l)return g(7);var f=(p={},p[i]=t,p[s]=n,p[r]=e,p)[m]||1,v=this.$d.getTime()+o*f;return S.w(v,this)},v.subtract=function(e,t){return this.add(-1*e,t)},v.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var o=e||"YYYY-MM-DDTHH:mm:ssZ",r=S.z(this),i=this.$H,s=this.$m,a=this.$M,l=n.weekdays,c=n.months,d=function(e,n,r,i){return e&&(e[n]||e(t,o))||r[n].substr(0,i)},u=function(e){return S.s(i%12||12,e,"0")},p=n.meridiem||function(e,t,n){var o=e<12?"AM":"PM";return n?o.toLowerCase():o},m={YY:String(this.$y).slice(-2),YYYY:this.$y,M:a+1,MM:S.s(a+1,2,"0"),MMM:d(n.monthsShort,a,c,3),MMMM:d(c,a),D:this.$D,DD:S.s(this.$D,2,"0"),d:String(this.$W),dd:d(n.weekdaysMin,this.$W,l,2),ddd:d(n.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(i),HH:S.s(i,2,"0"),h:u(1),hh:u(2),a:p(i,s,!0),A:p(i,s,!1),m:String(s),mm:S.s(s,2,"0"),s:String(this.$s),ss:S.s(this.$s,2,"0"),SSS:S.s(this.$ms,3,"0"),Z:r};return o.replace(g,(function(e,t){return t||m[e]||r.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(o,p,h){var m,g=S.p(p),f=w(o),v=(f.utcOffset()-this.utcOffset())*t,_=this-f,y=S.m(this,f);return y=(m={},m[u]=y/12,m[c]=y,m[d]=y/3,m[l]=(_-v)/6048e5,m[a]=(_-v)/864e5,m[s]=_/n,m[i]=_/t,m[r]=_/e,m)[g]||_,h?y:S.a(y)},v.daysInMonth=function(){return this.endOf(c).$D},v.$locale=function(){return $[this.$L]},v.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),o=b(e,t,!0);return o&&(n.$L=o),n},v.clone=function(){return S.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},f}(),E=M.prototype;return w.prototype=E,[["$ms",o],["$s",r],["$m",i],["$H",s],["$W",a],["$M",c],["$y",u],["$D",p]].forEach((function(e){E[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),w.extend=function(e,t){return e.$i||(e(t,M,w),e.$i=!0),w},w.locale=b,w.isDayjs=O,w.unix=function(e){return w(1e3*e)},w.en=$[y],w.Ls=$,w.p={},w}()}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";const e=[59.931429,30.325081],t="hotels-list",o=`${t}:expire`,r=`${t}:prices`,i="price-list",s=`${i}:expire`,a=`${i}:prices`,l="minute",c={ru:{SelectDate:"Выберите дату",From:"От",NoPlaces:"Нет мест",Apartments:"квартиры",Busy:"Занято",Booking:"Забронировать",MapShow:"Посмотреть отели на карте",MapClose:"Свернуть карту"},en:{SelectDate:"Select date",From:"From",NoPlaces:"No places",Apartments:"apart.",Busy:"Busy",Booking:"Book now",MapShow:"View hotels on the map",MapClose:"Collapse map"}},d=(e,t,n,o)=>{const r=c[MAP_BOOKING_LANG];return` <div class="map__hint ${o==n?"active":""} ${t?"":"no-rooms "}" id="${n}">\n            <div class="map__hint-icon"></div>\n            <div class="map__hint-price"> ${{loader:localStorage.getItem("tl-arrivalDate")?'<div class="loader"></div>':r.SelectDate,price:t?r.From+" "+t+" ₽":r.NoPlaces}[e]}</div>\n          </div>`},u=(e,t,n,o,r)=>{const i=c[MAP_BOOKING_LANG],s=e[MAP_BOOKING_LANG],a=t[MAP_BOOKING_LANG],l=n?i.From+" "+n+" ₽":i.NoPlaces,d=`\n        <div class="balloon-button">\n                <a href="/booking/?hotel_id=${o}&date=${(new Date).toISOString().slice(0,10)}&nights=1&adults=1" class="balloon-button__link">${i.Booking}</a>\n        </div>`;return`  <div class="map__balloon">\n            <div class="balloon-hotel">${s}</div>\n             <div class="balloon-address">${a}</div>\n            <div class="balloon-price">${l}</div>\n            ${r?"":d}\n        </div`};var p=n(353),h=n.n(p);const m=async()=>{const e=await fetch("/map-booking/cache/hotel_list.json");return e.ok||console.error("null"),await e.json()},g=()=>{const e=localStorage.getItem(r);return!e||localStorage.getItem(o)<=_()?"":JSON.parse(e)},f=e=>{localStorage.setItem(r,e),localStorage.setItem(o,v().toString())},v=()=>h()().add(1440,l).unix(),_=()=>h()().unix(),y=(e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},$=()=>{let e=document.querySelector(".accordion-text");const t=document.querySelector(".accordion-map"),n=document.querySelector(".map-booking"),o=document.querySelector(".map__mobile-text");n.classList.contains("map-show")?e.innerText=c[MAP_BOOKING_LANG].MapClose:e.innerText=c[MAP_BOOKING_LANG].MapShow,t.addEventListener("click",(function(){n.classList.toggle("map-show"),n.classList.contains("map-show")?e.innerText=c[MAP_BOOKING_LANG].MapClose:e.innerText=c[MAP_BOOKING_LANG].MapShow})),o.addEventListener("click",(function(){this.style.display="none"})),document.querySelectorAll(".map__balloon-room").forEach((e=>{e.addEventListener("click",b)}))},O=(e,t)=>(e-t)/864e5,b=()=>{document.getElementById("tl-booking-form").scrollIntoView({block:"start",behavior:"smooth"})};function w(e,t,n){var o=window.location.search,r=e+"="+n,i="";i=-1!=o.indexOf(e)?o.replace(t,r):""==o?o+"?"+r:o+"&"+r,window.history.pushState(!1,!1,i)}const S=()=>{const e=g(),t=[];return Object.keys(e.hotels).forEach((n=>{let o=e.hotels[n],r={id:n,name:o.name,address:o.address,latitude:o.latitude,longitude:o.longitude,iconContent:d("loader"),width:100,roomTypes:o.rooms};t.push(r)})),t},M=()=>{let e=(()=>{let e=g(),t=[],n=[],o=[],r=[],i=y("hotel");e=e.apart,i&&(e.forEach((e=>{scenariosListHotel[i].toString().includes(e.id)&&t.push(e)})),e=t);for(let t=0;t<e.length;t++){let i=!0;if(n.forEach((n=>{n.longitude===e[t].longitude&&n.latitude===e[t].latitude&&(i=!1)})),!1!==i){o.address=e[t].address[MAP_BOOKING_LANG],o.longitude=e[t].longitude,o.latitude=e[t].latitude,r.push(e[t]);for(let n=t+1;n<e.length-1;n++)e[t].longitude===e[n].longitude&&e[t].latitude===e[n].latitude&&r.push(e[n]);o.rooms=r,n.push(o),o=[],r=[]}}return n})(),t=[];return e.forEach(((e,n)=>{let o=[];e.rooms.forEach((e=>{o.push(e.id)}));let r={id:"marker-"+n,address:e.address,latitude:e.rooms[0].latitude,longitude:e.rooms[0].longitude,iconContent:d("loader"),width:90,roomTypes:o.join(",")};t.push(r)})),t},E=(e,t,n)=>{(async e=>{const t=await fetch(e);return t.ok||console.error("null"),await t.json()})(e).then((e=>{A(JSON.stringify(e));let o,r=((e,t)=>{let n=[],o=[];return Object.keys(e).map((r=>{o=[],Object.values(e[r]).map((e=>{o.push(e[t])})),n[r]=Math.min.apply(null,o)})),n})(e,n),i=S();return t&&(o=document.querySelector("#tl-hotel-select").value),console.log(i),console.log(q[0]),i.forEach(((e,n)=>{console.log(n),console.log(q[n]);let i=q[n].properties.get("name"),s=q[n].properties.get("address"),a=q[n].properties.get("id"),l=r[a];if(q[n].properties.set("iconContent",d("price",l,a,t)),q[n].properties.set("balloonContent",u(i,s,l,a,t)),q[n].properties.set("clusterCaption",u(i,s,l,a,t)),t&&a==o)try{q[n].balloon.open()}catch(e){let t=q[n].geometry.getCoordinates();Z.setCenter(t,13,{duration:300}),setTimeout((()=>q[n].balloon.open()),350)}})),e})).catch((e=>{console.log(e),console.log("not load price")}))},I=()=>{const e=localStorage.getItem(r);return!e||localStorage.getItem(r)<=N()?"":JSON.parse(e)},A=e=>{localStorage.setItem(a,e),localStorage.setItem(s,C().toString())},C=()=>h()().add(1440,l).unix(),N=()=>h()().unix(),B=(e,t,n,o)=>` <div class="map__hint ${t?"":"no-rooms"}" id="${n}">\n            <div class="map__hint-icon"></div>\n            <div class="map__hint-price"> ${{loader:localStorage.getItem("tl-arrivalDate")?'<div class="loader"></div>':c[MAP_BOOKING_LANG].SelectDate,price:t?c[MAP_BOOKING_LANG].From+" "+t+" ₽":c[MAP_BOOKING_LANG].NoPlaces}[e]} ${o>1?" ("+o+" "+c[MAP_BOOKING_LANG].Apartments+")":""}</div>\n          </div>`,L=(e,t)=>`  <div class="map__balloon">\n            <div class="map__balloon-address">${e}</div>\n            ${function(e){return e.length?e.map((e=>` <div class="map__balloon-room">\n                     <div class="map__balloon-room-name">${e.name[MAP_BOOKING_LANG]}</div>\n                     <div class="map__balloon-room-status ${!!e.price}">${e.price?c[MAP_BOOKING_LANG].From+" "+e.price+" ₽":c[MAP_BOOKING_LANG].Busy}</div>\n                </div>`)).join(""):` <div class="map__balloon-room">\n             <div class="map__balloon-room-name">${c[MAP_BOOKING_LANG].NoPlaces}</div>\n        </div>`}(t)}\n        </div`;const k=()=>{const e=getComputedStyle(document.documentElement).getPropertyValue("--basic").trim();K.getClusters().forEach((t=>{let n=!1;t.properties.get("geoObjects").forEach((o=>{o.properties.get("price")&&!1===n&&(n=!0,t.options.set("clusterIconColor",e))}))}))},D=e=>{let t,n=I(),o=M();n=n.apart,e?(e.forEach((e=>{q.forEach((t=>{t.properties.get("roomTypes").includes(e.id)&&(t.properties._data.price=e.price)}))})),o.forEach(((o,r)=>{let i,s=[],a=[];i=o.roomTypes,n.forEach((e=>{-1!==i.indexOf(e.id)&&a.push(e)})),e&&e.forEach((e=>{a.forEach((t=>{e.id===t.id&&(s.push(e.price),t.price=e.price)}))})),a.sort(((e,t)=>null==e.price?"1":null==t.price?"-1":e.price-t.price)),t=s.length?Math.min.apply(null,s):null;let l=q[r].properties.get("address"),c=q[r].properties.get("id");q[r].properties.set("iconContent",B("price",t,c,a.length)),q[r].properties.set("balloonContent",L(l,a))})),k(),Z.events.add("boundschange",(function(e){e.get("newZoom")!==e.get("oldZoom")&&k()}))):q.forEach((e=>{e.properties.set("iconContent",B("price",void 0))}))};function x(e){let t=S();Z.balloon.close(),t.forEach(((t,n)=>{if(q[n].properties.get("id")==e){let e=q[n].properties.get("iconContent").replace('class="map__hint','class="map__hint active'),t=q[n].geometry.getCoordinates();Z.setCenter(t,12,{duration:300}),q[n].properties.set("iconContent",e),setTimeout((()=>{try{q[n].balloon.open()}catch(e){Z.setCenter(t,12,{duration:300}),q[n].balloon.open()}}),350)}else{let e=q[n].properties.get("iconContent").replace('class="map__hint active','class="map__hint');q[n].properties.set("iconContent",e)}})),G(e)}const G=e=>{var t="hotel",n=new RegExp(/hotel=[A-Za-z0-9_-]+/g),o=window.location.search,r=t+"="+e,i="";i=-1!=o.indexOf(t)?o.replace(n,r):""==o?o+"?"+r:o+"&"+r,window.history.pushState(!1,!1,i)};function T(e,t){if(document.createEventObject){var n=document.createEventObject();return e.fireEvent("on"+t,n)}var o=document.createEvent("HTMLEvents");return o.initEvent(t,!0,!0),!e.dispatchEvent(o)}function P(e){let t,n=null;if("search-rooms"===e.action){if(t=e.rooms,n=I(),y("date")){let t=e.arrival,n=e.departure,o=O(new Date(n),new Date(t));w("date",new RegExp(/date=[A-Za-z0-9_-]+/g),t),w("nights",new RegExp(/nights=\d+/g),o)}D(t)}}function j(e){let t=e.rooms;I();D(t)}function H(e){let t=Object.keys(JSON.parse(localStorage.getItem("tl:storage:puid")))[0];!function(n){var o;o=[["setContext",t,`${MAP_BOOKING_LANG}`],["embed","booking-form",{container:"tl-booking-form",roomType:e,autoScroll:"none",onTrackUserAction:P,onNoAvailableRooms:j}]];var r=n.travelline=n.travelline||{},i=r.integration=r.integration||{};if(i.__cq=i.__cq?i.__cq.concat(o):o,!i.__loader){i.__loader=!0;var s=n.document,a=s.getElementsByTagName("head")[0]||s.getElementsByTagName("body")[0];function l(e,t){return function(){n.TL||(a.removeChild(e),t())}}!function e(t){if(0!==t.length){var n=s.createElement("script");n.type="text/javascript",n.async=!0,n.src="https://"+t[0]+"/integration/loader.js",n.onerror=n.onload=l(n,(function(){e(t.slice(1,t.length))})),a.appendChild(n)}}(["ru-ibe.tlintegration.ru","ibe.tlintegration.ru","ibe.tlintegration.com"])}}(window)}let K,Z,q=[],z=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function F(){Z=new ymaps.Map("map-be",{center:e,zoom:13,controls:["zoomControl"],behaviors:z?["dblClickZoom","multiTouch"]:["drag","scrollZoom"]}),"hotels".includes(Object.keys(g()))&&Y(S()),"apart".includes(Object.keys(g()))&&R(M())}let Y=e=>{Z.geoObjects.removeAll(),q.length=0,Z.setZoom(12),e.forEach(((t,n)=>{q[n]=new ymaps.Placemark([e[n].latitude,e[n].longitude],{iconContent:e[n].iconContent,id:e[n].id,name:e[n].name,address:e[n].address,roomTypes:e[n].roomTypes,price:null},{iconLayout:"default#imageWithContent",iconImageSize:[e[n].width,30],iconImageOffset:[0,-15],iconImageClipRect:[[415,0],[461,57]],hideIconOnBalloonOpen:!1,balloonOffset:[20,-15]}),q[n].events.add("click",(function(e){let t=e.get("target").properties.get("id");null==document.getElementById(t)?b():document.getElementById(t).classList.contains("active")||(G(t),function(){let e=y("hotel"),t=document.querySelector("#tl-hotel-select");t&&(t.value=e,T(t[0],"change"))}()),S().forEach(((e,n)=>{if(q[n].properties.get("id")===t){let e=q[n].properties.get("iconContent").replace('class="map__hint','class="map__hint active');q[n].properties.set("iconContent",e)}else{let e=q[n].properties.get("iconContent").replace('class="map__hint active','class="map__hint');q[n].properties.set("iconContent",e)}})),e.stopPropagation()})),q[n].events.add("balloonopen",(function(){let e=document.querySelectorAll(".balloon-hotel"),t=document.getElementById("tl-booking-form"),n=()=>{t.scrollIntoView({block:"end",behavior:"smooth"})};e.forEach((e=>{e.addEventListener("click",n)}))}))})),K=new ymaps.Clusterer({gridSize:12,clusterIconColor:"#76689A"}),Z.geoObjects.add(K),K.add(q),Z.setBounds(Z.geoObjects.getBounds()),(()=>{let e;S().forEach(((t,n)=>{let o=[];e=o.length?Math.min.apply(null,o):null,q[n].properties.set("iconContent",d("loader",e))})),k(),Z.events.add("boundschange",(function(e){e.get("newZoom")!==e.get("oldZoom")&&k()}))})(g())},R=e=>{Z.geoObjects.removeAll(),q.length=0,Z.setZoom(12),e.forEach(((t,n)=>{q[n]=new ymaps.Placemark([e[n].latitude,e[n].longitude],{iconContent:e[n].iconContent,roomTypes:e[n].roomTypes,address:e[n].address,id:e[n].id,price:null},{iconLayout:"default#imageWithContent",iconImageSize:[e[n].width,30],iconImageOffset:[0,-15],iconImageClipRect:[[415,0],[461,57]],hideIconOnBalloonOpen:!1,balloonOffset:[20,-15]}),q[n].events.add("click",(function(e){let t=e.get("target"),n=t.properties.get("roomTypes"),o=t.properties.get("id");null==document.getElementById(o)?b():document.getElementById(o).classList.contains("active")||H(n),document.querySelectorAll(".map__hint").forEach((e=>{e.classList.remove("active")})),document.getElementById(o)&&(document.getElementById(o).classList.add("active-check"),document.getElementById(o).classList.add("active")),e.stopPropagation()})),q[n].events.add("balloonopen",(function(){let e=document.getElementById("tl-booking-form"),t=document.querySelectorAll(".map__balloon-room"),n=()=>{e.scrollIntoView({block:"end",behavior:"smooth"})};t.forEach((e=>{e.addEventListener("click",n)}))})),q[n].events.add("balloonclose",(function(e){let t=e.get("target").properties.get("id");document.getElementById(t)&&(document.getElementById(t).classList.add("active-check"),document.getElementById(t).classList.remove("active"))}))})),K=new ymaps.Clusterer({gridSize:115,clusterIconColor:"#7F7165"}),K.events.add("click",(e=>{if(ymaps.util.bounds.containsBounds(Z.getBounds(),K.getBounds())){K.options.set("clusterDisableClickZoom",!0),e.stopPropagation();const t=ymaps.util.bounds.getCenter(K.getBounds());Z.setCenter(t,Z.getZoom()+5)}K.options.set("clusterDisableClickZoom",!1)})),Z.geoObjects.add(K),K.add(q),Z.setBounds(Z.geoObjects.getBounds())};const J=()=>{window.MAP_BOOKING_LANG=(()=>{const e=document.documentElement.lang,t=Object.keys(c),n=2===e.length?e.toLowerCase():e.substring(0,2);return t.includes(n)?n:"not-supported"})()};class W{constructor(){this._cacheHotels=g()}isLoadNeeded(){return!this._cacheHotels}load(){return m().then((e=>(f(JSON.stringify(e)),e))).catch((e=>{console.log("HotelLoad load error:"),console.log(e)}))}getFromCache(){return console.log(this._cacheHotels),JSON.parse(this._cacheHotels)}}let V=!1;window.setTlHotel=()=>{(new W).load().then((()=>{J(),$(),localStorage.getItem(r)||m().then((e=>(f(JSON.stringify(e)),e))).catch((()=>{console.log("not load")})),ymaps.ready(F),V=!0}))},document.addEventListener("DOMContentLoaded",(()=>{window.setTlHotel()})),window.mapBookingHotel=(e,t,n,o,r)=>{function i(){if(V){if(((e,t,n,o)=>{const r=`/map-booking/core/price-api.php?date=${e}&nights=${t}&adults=${n}`;let i=S();0!==q.length&&i.forEach(((e,t)=>{q[t].properties.set("iconContent",d("loader"))})),E(r,o,n)})(e,t,n,o),Z.balloon.close(),y("date")){w("date",new RegExp(/date=[A-Za-z0-9_-]+/g),e),w("nights",new RegExp(/nights=\d+/g),t)}}else setTimeout(i,300)}i(),document.querySelector("#tl-hotel-select").addEventListener("change",(function(){x(this.value)}))},window.mapBookingApart=(e,t,n)=>{!function o(){if(V){if(Z.balloon.close(),D(e),y("date")){w("date",new RegExp(/date=[A-Za-z0-9_-]+/g),t);let e=O(new Date(n),new Date(t));w("nights",new RegExp(/nights=\d+/g),e)}}else setTimeout(o,300)}()}}()}();
//# sourceMappingURL=map-booking.js.map
